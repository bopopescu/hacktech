<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">

  <title>I'd like to Roomba Roomba</title>
  <meta name="description" content="A basic web interface for our Roomba HackTech project.">
  <meta name="author" content="Chau Nguyen">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">

  <link rel="stylesheet" href="css/index.css?v=1.0">

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <div class="container">
    <header></header>
    <h2>Roomba Dashboard</h2>
    <div class="row">
      <div class="col s6">
        <div id="controls">
          <div class="col s12 offset-s3">
            <img id="ctrl-arr-up" class='responsive-img ctrl-arr' src="images/arrow-up.png" />
          </div>
          <img id="ctrl-arr-left" class='responsive-img ctrl-arr' src="images/arrow-left.png" />
          <img id="stop-driving-btn" class='responsive-img ctrl-arr' src="images/stop.png" />
          <img id="ctrl-arr-right" class='responsive-img ctrl-arr' src="images/arrow-right.png" />
          <div class="col s12 offset-s3">
            <img class='responsive-img ctrl-arr ctrl-arr-down' src="images/arrow-down.png" />
          </div>
        </div>
      </div>
      <div class="col s6">
        <div id="bumpers">
          <h5 id="bumpers-header">Bumpers</h5>
          <svg viewBox='0 0 100 100'>
            <circle cx='50' cy='50' r='45' id='gray' />
            <circle cx='50' cy='50' r='45' id='top-left' />
            <circle cx='50' cy='50' r='45' id='top-right' />
            <circle cx='50' cy='50' r='45' id='blue' />
            <circle cx='50' cy='50' r='45' id='orange' />
          </svg>
        </div>
      </div>
    </div>

    <div id="detailed-statistics">
      <div class="row">
        <ul id="statistics-list">
          <div class="col s4">
            <li id="battery" class="statistic">
              <img class='dashboard-icon' src="images/battery.jpg" />
              <h5 class='statistic-header'>&nbsp;Battery</h5>
              <span id="battery-data"></span>
            </li>
          </div>
          <div class="col s4">
            <li id="distance" class="statistic">
              <img class='dashboard-icon' src="images/distance.png" />
              <h5 class='statistic-header'>&nbsp;Distance</h5>
              <span id="distance-data"></span>
            </li>
          </div>
          <div class="col s4">
            <li id="angle" class="statistic">
              <img class='dashboard-icon' src="./images/angle.png" />
              <h5 class='statistic-header'>&nbsp;Angle</h5>
              <span id="angle-data"></span>
            </li>
          </div>
          <div class="col s3">
            <li id="cliff-left" class="statistic">
              <img class='dashboard-icon' src="./images/cliff-left.jpg" />
              <h5 class='statistic-header'>&nbsp;Cliff Left</h5>
              <span id="cliff-left-data"></span>
            </li>
          </div>
          <div class="col s3">
            <li id="cliff-front-left" class="statistic">
              <img class='dashboard-icon' src="./images/cliff-ft-left.png" />
              <h5 class='statistic-header'>&nbsp;Cliff Ft Left</h5>
              <span id="cliff-front-left-data"></span>
            </li>
          </div>
          <div class="col s3">
            <li id="cliff-front-right" class="statistic">
              <img class='dashboard-icon' src="./images/cliff-ft-right.png" />
              <h5 class='statistic-header'>&nbsp;Cliff Ft Right</h5>
              <span id="cliff-front-right-data"></span>
            </li>
          </div>
          <div class="col s3">
            <li id="cliff-right" class="statistic">
              <img class='dashboard-icon' src="./images/cliff-right.jpg" />
              <h5 class='statistic-header'>&nbsp;Cliff Right</h5>
              <span id="cliff-right-data"></span>
            </li>
          </div>
          <div class="col s6">
            <li id="bump-left" class="statistic">
              <img class='dashboard-icon' src="./images/bump.png" />
              <h5 class='statistic-header'>&nbsp;Bump Left</h5>
              <span id="bump-left-data"></span>
            </li>
          </div>
          <div class="col s6">
            <li id="bump-right" class="statistic">
              <img class='dashboard-icon' src="./images/bump.png" />
              <h5 class='statistic-header'>&nbsp;Bump Right</h5>
              <span id="bump-right-data"></span>
            </li>
          </div>
          <!--<div class="col s4">
            <li id="wall" class="statistic">
              <img class='dashboard-icon' src="./images/wall.png" />
              <h5 class='statistic-header'>&nbsp;Wall</h5>
              <span id="wall-data"></span>
            </li>
            </div>-->
          <div class="col s12">
            <li id="velocity" class="statistic">
              Velocity:
              <span id="velocity-data"></span>
            </li>
          </div>
          <div class="col s2">
            <li id="light-bump-left" class="statistic">
              <h6 class='statistic-header'>&nbsp;LB Left</h6>
              <span id="light-bump-left-data"></span>
            </li>
          </div>
          <div class="col s2">
            <li id="light-bump-front-left" class="statistic">
              <h6 class='statistic-header'>&nbsp;LB Ft Left</h6>
              <span id="light-bump-front-left-data" class='light-bump'></span>
            </li>
          </div>
          <div class="col s2">
            <li id="light-bump-center-left" class="statistic">
              <h6 class='statistic-header'>&nbsp;LB Cen Left</h6>
              <span id="light-bump-center-left-data" class='light-bump'></span>
            </li>
          </div>
          <div class="col s2">
            <li id="light-bump-center-right" class="statistic">
              <h6 class='statistic-header'>&nbsp;LB Cen Right</h6>
              <span id="light-bump-center-right-data" class='light-bump'></span>
            </li>
          </div>
          <div class="col s2">
            <li id="light-bump-front-right" class="statistic">
              <h6 class='statistic-header'>&nbsp;LB Ft. Right</h6>
              <span id="light-bump-front-right-data" class='light-bump'></span>
            </li>
          </div>
          <div class="col s2">
            <li id="light-bump-right" class="statistic">
              <h6 class='statistic-header'>&nbsp;LB Right</h6>
              <span id="light-bump-right-data" class='light-bump'></span>
            </li>
          </div>
          <div class="col s6">
            <li id="left-encoder" class="statistic">
              <h5 class='statistic-header'>&nbsp;Left Encoder</h5>
              <span id="left-encoder-data"></span>
            </li>
          </div>
          <div class="col s6">
            <li id="right-encoder" class="statistic">
              <h5 class='statistic-header'>&nbsp;Right Encoder</h5>
              <span id="right-encoder-data"></span>
            </li>
          </div>
        </ul>
      </div>
    </div>
  </div>

  <div id="my-canvas" style="position: relative;">
    <canvas id="path_layer" style="position: absolute; left: 0; top: 0; z-index: 0; border:1px solid #d3d3d3;"></canvas>
    <canvas id="robot_body_layer" style="position: absolute; left: 0; top: 0; z-index: 1; border:1px solid #d3d3d3;"></canvas>
    <canvas id="text_layer" style="position: absolute; left: 0; top: 0; z-index: 2; border:1px solid #d3d3d3;"></canvas>
  </div>
  </div>

  <!-- Compiled and minified JavaScript -->
  <script src="
https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
  <!--<script src="js/map.js"></script>-->
  <script type="text/javascript">
    var pathLayerContext;
    var robotBodyLayerContext;
    var textLayerContext;

    var pathLayer;
    var robotBodyLayer;
    var textLayer;

    var lastPhase = '';
    var mapping = true;

    var sizeX = 800;
    var sizeY = 800;
    var pointIntervalMs = 800;
    var xOffset = 120;
    var yOffset = 505;

    console.log('INITIATe MAP');

    pathLayer = document.getElementById('path_layer');
    robotBodyLayer = document.getElementById('robot_body_layer');
    textLayer = document.getElementById('text_layer');

    pathLayer.width = sizeX;
    pathLayer.height = sizeY;

    robotBodyLayer.width = sizeX;
    robotBodyLayer.height = sizeY;

    textLayer.width = sizeX;
    textLayer.height = sizeY;

    // $('#sizew').val(sizeX);
    // $('#sizeh').val(sizeY);

    // $('#offsetx').val(xOffset);
    // $('#offsety').val(yOffset);

    // $('#updateevery').val(updateEvery);

    pathLayerContext = pathLayer.getContext('2d');
    robotBodyLayerContext = robotBodyLayer.getContext('2d');
    textLayerContext = textLayer.getContext('2d');

    pathLayerContext.beginPath();
    pathLayerContext.lineWidth = 1;
    pathLayerContext.strokeStyle = '#000000';
    pathLayerContext.lineCap = 'round';

    // drawStep(
    //     0,
    //     0,
    //     0,
    //     'quick',
    //     'run'
    // );

    // drawStep(
    //     100,
    //     200,
    //     50,
    //     'quick',
    //     'run'
    // );

    // drawStep(
    //     150,
    //     250,
    //     60,
    //     'quick',
    //     'run'
    // );

    // drawStep(
    //     300,
    //     250,
    //     40,
    //     'quick',
    //     'run'
    // );

    //  drawStep(
    //     300,
    //     250,
    //     80,
    //     'quick',
    //     'run'
    // );

    function messageHandler(msg) {
      // msg is the object returned by dorita980.getMission() promise.
      // if (msg.cleanMissionStatus) {
      //     // firmware version 2
      //     msg.ok = msg.cleanMissionStatus;
      //     msg.ok.pos = msg.pose;
      //     msg.ok.batPct = msg.batPct;
      //     $('#bin').html(msg.bin.present);
      //     $('#nMssn').html(msg.ok.nMssn);
      // }
      // msg.ok.time = new Date().toISOString();
      // $('#mapStatus').html('drawing...');
      // $('#last').html(msg.ok.time);
      // $('#mission').html(msg.ok.mssnM);
      // $('#cycle').html(msg.ok.cycle);
      // $('#phase').html(msg.ok.phase);
      // $('#flags').html(msg.ok.flags);
      // $('#batPct').html(msg.ok.batPct);
      // $('#error').html(msg.ok.error);
      // $('#sqft').html(msg.ok.sqft);
      // $('#expireM').html(msg.ok.expireM);
      // $('#rechrgM').html(msg.ok.rechrgM);
      // $('#notReady').html(msg.ok.notReady);
      // $('#theta').html(msg.ok.pos.theta);
      // $('#x').html(msg.ok.pos.point.x);
      // $('#y').html(msg.ok.pos.point.y);

      drawStep(
        msg.ok.pos.point.x,
        msg.ok.pos.point.y,
        msg.ok.pos.theta,
        msg.ok.cycle,
        msg.ok.phase
      );
    }

    function drawStep(x, y, theta, cycle, phase) {
      if (phase === 'charge') {
        // hack (getMission() dont send x,y if phase is diferent as run)
        x = 0;
        y = 0;
      }

      x = parseInt(x, 10) + xOffset;
      y = parseInt(y, 10) + yOffset;
      var oldX = x;

      // rotate
      x = y;
      y = pathLayer.height - oldX;
      x = pathLayer.width - x;

      drawRobotBody(x, y, theta);

      // draw changes in status with text.
      if (phase !== lastPhase) {
        textLayerContext.font = 'normal 12pt Calibri';
        textLayerContext.fillStyle = 'blue';
        textLayerContext.fillText(phase, x, y);
        lastPhase = phase;
      } else {
        pathLayerContext.lineTo(x, y);
        pathLayerContext.stroke();
      }
    }

    function drawRobotBody(x, y, theta) {
      theta = parseInt(theta, 10);
      var radio = 15;
      robotBodyLayerContext.clearRect(0, 0, robotBodyLayer.width, robotBodyLayer.height);
      robotBodyLayerContext.beginPath();
      robotBodyLayerContext.arc(x, y, radio, 0, 2 * Math.PI, false);
      robotBodyLayerContext.fillStyle = 'green';
      robotBodyLayerContext.fill();
      robotBodyLayerContext.lineWidth = 3;
      robotBodyLayerContext.strokeStyle = '#003300';
      robotBodyLayerContext.stroke();

      var outerX = x + radio * Math.cos((theta - 90) * (Math.PI / 180));
      var outerY = y + radio * Math.sin((theta - 90) * (Math.PI / 180));

      robotBodyLayerContext.beginPath();
      robotBodyLayerContext.moveTo(x, y);
      robotBodyLayerContext.lineTo(outerX, outerY);
      robotBodyLayerContext.strokeStyle = '#003300';
      robotBodyLayerContext.lineWidth = 3;
      robotBodyLayerContext.stroke();
    }

    function clearMap() {
      lastPhase = '';
      pathLayerContext.clearRect(0, 0, pathLayer.width, pathLayer.height);
      robotBodyLayerContext.clearRect(0, 0, robotBodyLayer.width, robotBodyLayer.height);
      textLayerContext.clearRect(0, 0, textLayer.width, textLayer.height);
      pathLayerContext.beginPath();
    }

    function toggleMapping() {
      mapping = !mapping;
      if (mapping) startMissionLoop();
    }

    // function getValue(name, actual) {
    //     var newValue = parseInt($(name).val(), 10);
    //     if (isNaN(newValue)) {
    //         alert('Invalid ' + name);
    //         $(name).val(actual);
    //         return actual;
    //     }
    //     return newValue;
    // }

    function shiftCanvas(ctx, w, h, dx, dy) {
      var imageData = ctx.getImageData(0, 0, w, h);
      ctx.clearRect(0, 0, w, h);
      ctx.putImageData(imageData, dx, dy);
    }

    // function saveValues() {
    //     var values = {
    //         'offsetX': getValue('#offsetx', xOffset),
    //         'offsetY': getValue('#offsety', yOffset),
    //         'sizeW': getValue('#sizew', pathLayer.width),
    //         'sizeH': getValue('#sizeh', pathLayer.height),
    //         'pointIntervalMs': updateEvery
    //     };
    //     $.post('/map/values', values, function (data) {
    //     });
    // }

    // $('.metrics').on('change', function () {
    //     var w = getValue('#sizew', pathLayer.width);
    //     var h = getValue('#sizeh', pathLayer.height);
    //     if (pathLayer.width !== w) {
    //         pathLayerContext.beginPath();
    //         shiftCanvas(textLayerContext, w, h, (w - pathLayer.width), 0);
    //         shiftCanvas(pathLayerContext, w, h, (w - pathLayer.width), 0);
    //         var imgDataW = pathLayerContext.getImageData(0, 0, pathLayer.width, pathLayer.height);
    //         var imgDataT1 = textLayerContext.getImageData(0, 0, textLayer.width, textLayer.height);
    //         pathLayer.width = w;
    //         robotBodyLayer.width = w;
    //         textLayer.width = w;
    //         pathLayerContext.putImageData(imgDataW, 0, 0);
    //         textLayerContext.putImageData(imgDataT1, 0, 0);
    //     }

    //     if (pathLayer.height !== h) {
    //         pathLayerContext.beginPath();
    //         shiftCanvas(textLayerContext, w, h, 0, (h - pathLayer.height));
    //         shiftCanvas(pathLayerContext, w, h, 0, (h - pathLayer.height));
    //         var imgDataH = pathLayerContext.getImageData(0, 0, pathLayer.width, pathLayer.height);
    //         var imgDataT2 = textLayerContext.getImageData(0, 0, textLayer.width, textLayer.height);
    //         pathLayer.height = h;
    //         robotBodyLayer.height = h;
    //         textLayer.height = h;
    //         pathLayerContext.putImageData(imgDataH, 0, 0);
    //         textLayerContext.putImageData(imgDataT2, 0, 0);
    //     }

    //     var newYOffset = getValue('#offsety', yOffset);
    //     if (newYOffset !== yOffset) {
    //         pathLayerContext.beginPath();
    //         shiftCanvas(pathLayerContext, w, h, (yOffset - newYOffset), 0);
    //         shiftCanvas(textLayerContext, w, h, (yOffset - newYOffset), 0);
    //         yOffset = newYOffset;
    //     }
    //     var newXOffset = getValue('#offsetx', xOffset);
    //     if (newXOffset !== xOffset) {
    //         pathLayerContext.beginPath();
    //         shiftCanvas(pathLayerContext, w, h, 0, (xOffset - newXOffset));
    //         shiftCanvas(textLayerContext, w, h, 0, (xOffset - newXOffset));
    //         xOffset = newXOffset;
    //     }
    // });

    console.log('begin');
    var socket = io();

    console.log('socket begins');

    // fetch('/currentData').then(function (response) { return response.text() }).then(function (body) {
    //     console.log(body);
    //   });
    var lastAngle = 0;
    var lastEncLeft = 0;
    var lastEncRight = 0;
    var currX = 0;
    var currY = 0;
    var moving = false;
    socket.emit('reset-robot', function (data) {
      console.log('reset-robot')
    });
    // socket.emit('reset-robot', function(data) {
    //   console.log(data);
    //   console.log('resetted');
    // });
    // function drawWithUpdatedData() {
    //   fetch('currentPos')
    //             .then(res => {
    //               console.log('got response');
    //             return res.json() })
    //             .then(body => {
    //               console.log('getting request')
    //             console.log(body); 
    //             drawStep(body.distance, 0, body.angle, 'quick', 'run');
    //             console.log('drawn');
    //           });
    // }
    // document.getElementById('cliff-left-data').style.color = 'red';
    // document.getElementById('cliff-left-data').innerHTML = "<span class='warning fade-in'>!</span>"
    document.getElementById('cliff-left-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('cliff-front-left-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('cliff-front-right-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('cliff-right-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('bump-left-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('bump-right-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('light-bump-left-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('light-bump-front-left-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    //#light-bump-center-left-data, #light-bump-center-right-data, #light-bump-front-right-data, #light-bump-right-data 
    document.getElementById('light-bump-center-left-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('light-bump-center-right-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('light-bump-front-right-data').innerHTML = "<span style='color:red;' class='warning fade-in'>!</span>";
    document.getElementById('light-bump-right-data').innerHTML = "<span style='color:green' fade-in'><i class='fa fa-check'></i></span>";
    document.getElementById('stop-driving-btn').onclick = function () {
      socket.emit('stop-moving', function (data) {
        console.log('stop')
      });
    }

    document.getElementById('angle-data').innerHTML = 50;
    document.getElementById('angle-data').innerHTML += '&nbsp<i class="red-arr fa fa-arrow-down" aria-hidden="true"></i>';

    document.getElementById('distance-data').innerHTML = 50;
    document.getElementById('distance-data').innerHTML += '&nbsp;mm';

    document.getElementById('left-encoder-data').innerHTML += '20000&nbsp<i class="green-arr fa fa-arrow-up" aria-hidden="true"></i>';
    document.getElementById('right-encoder-data').innerHTML += '50000&nbsp<i class="green-arr fa fa-arrow-up" aria-hidden="true"></i>';
    // document.getElementById('light-bump-left-data').innerHTML = call.lightBumpLeft;;
    document.getElementById("ctrl-arr-up").onclick = function () {
            var payload = {
        "id": "8ccb9659-788d-4fea-a2d6-6c510b02893c",
        "timestamp": "2017-03-04T17:34:34.916Z",
        "lang": "en",
        "result": {
          "source": "agent",
          "resolvedQuery": "move forward 2",
          "action": "move",
          "actionIncomplete": false,
          "parameters": {
            "direction": "forward",
            "distance": "2"
          },
          "contexts": [],
          "metadata": {
            "intentId": "1eb5d3e2-9674-4ae8-9032-fb9c886813d9",
            "webhookUsed": "true",
            "webhookForSlotFillingUsed": "false",
            "intentName": "move"
          },
          "fulfillment": {
            "speech": "moving",
            "messages": [
              {
                "type": 0,
                "speech": "moving"
              }
            ]
          },
          "score": 1
        },
        "status": {
          "code": 206,
          "errorType": "partial_content",
          "errorDetails": "Webhook call failed. Error message: org.springframework.web.client.RestClientException: Could not extract response: no suitable HttpMessageConverter found for response type [class com.speaktoit.api.server.webhook.model.WebhookResponse] and content type [text/html;charset=utf-8] ErrorId: e7acc75e-7fcc-4966-b108-26a6b334c66a"
        },
        "sessionId": "bed01bd8-c777-42ab-ae4a-15e9c6551d20"
      }
      var formData  = new FormData();

  for(name in payload) {
    formData.append(name, payload[name]);
  }
fetch('https://e3438682.ngrok.io', {
	method: 'post',
	body: JSON.stringify({
		email: "Hello",
		answer: "World"
  })
});
  // fetch('https://e3438682.ngrok.io', {
  //   // mode: 'no-cors',
  //   method: 'POST',
  //   body: formData
  // }).then(function (res) { return res.json(); }).then(function (data){
  //   console.log('hey');
  //   alert( JSON.stringify( ({hello: "world"})
  //    ) ) }).catch (function (error) {;
      // var data = new FormData();
      // console.log('payload:', payload)
      // data.append("json", JSON.stringify(payload));
      // console.log('data:',data);
      //https://e3438682.ngrok.io
    //   //https://b1873d15.ngrok.io
    //   fetch("https://e3438682.ngrok.io",
    //           { method: "POST", headers: {
    //     'Accept': 'application/json, text/plain, */*',
    //     'Content-Type': 'application/json'
    // }, body: data }).then(function (res) { return res.json(); }).then(function (data){ alert( JSON.stringify( data ) ) }).catch (function (error) {
    // console.log('Request failed', error);
// });

      console.log('clicked')
      socket.emit("move-up", function (data) {
        moving = true;
      });
    }

    document.getElementById("ctrl-arr-left").onclick = function () {
      console.log('clicked left arr')
      socket.emit("turn-left", function (data) {
        console.log(data);
      })
    }

    document.getElementById("ctrl-arr-right").onclick = function () {
      console.log('clicked right arr')
      socket.emit("turn-right", function (data) {
        console.log(data);
      })
    }

    document.getElementById("stop-driving-btn").onclick = function () {
      socket.emit("stop-moving", function (data) {
        if (moving) {
          // drawWithUpdatedData();
          moving = false;
        }
      });
    }
    socket.on('angle distance changed', function (call) {
      console.log('angle distance is changing');
      // drawStep(call.distance, 0, call.angle, 'quick', 'run');
      // console.log('distance:', distance);
    });

    socket.on('data has been sent', function (call) {
      // console.log(call);
      var booleans = { "false": false, "true": true };
      if (booleans[call.bumpLeft]) {
        document.getElementById('top-left').style.stroke = 'red';
      } else {
        document.getElementById('top-left').style.stroke = 'green';
      }

      if (booleans[call.bumpRight]) {
        document.getElementById('top-right').style.stroke = 'red';
      } else {
        document.getElementById('top-right').style.stroke = 'green';
      }

      if (call.chargeState)
        document.getElementById('battery-data').innerHTML = call.chargeState;

      if (call.distance)
        document.getElementById('distance-data').innerHTML = call.distance;

      if (call.angle) {
        document.getElementById('angle-data').innerHTML = call.angle;
        // console.log(lastAngle, call.angle)
        if (lastAngle < call.angle) {
          // console.log('lastAngle < call.angle')
          document.getElementById('angle-data').innerHTML += '&nbsp<i class="green-arr fa fa-arrow-up" aria-hidden="true"></i>';
        }
        else if (lastAngle > call.angle) {
          // console.log('lastAngle > call.angle')
          document.getElementById('angle-data').innerHTML += '&nbsp<i class="red-arr fa fa-arrow-down" aria-hidden="true"></i>';
        }
        lastAngle = call.angle;
      }


      var warning = "<span style='color:red;' class='warning'>!</span>";
      var safe = "<span style='color:green' fade-in'><i class='fa fa-check'></i></span>";
      if (call.cliffLeft) {
        // document.getElementById('cliff-left-data').innerHTML = "call.cliffLeft.toString();"
        if (booleans[call.cliffLeft]) {
          document.getElementById('cliff-left-data').innerHTML = warning;
        } else {
          document.getElementById('cliff-left-data').innerHTML = safe;
        }
      }

      if (call.cliffFrontLeft) {
        if (booleans[call.cliffFrontLeft]) {
          document.getElementById('cliff-front-left-data').innerHTML = warning;
        } else {
          document.getElementById('cliff-front-left-data').innerHTML = safe;
        }
      }

      if (call.cliffFrontRight) {
        if (booleans[call.cliffFrontRight]) {
          document.getElementById('cliff-front-right-data').innerHTML = warning;
        } else {
          document.getElementById('cliff-front-right-data').innerHTML = safe;
        }
      }

      if (call.cliffRight) {
        if (booleans[call.cliffRight]) {
          document.getElementById('cliff-right-data').innerHTML = warning;
        } else {
          document.getElementById('cliff-right-data').innerHTML = safe;
        }
      }

      if (call.bumpLeft) {
        if (booleans[call.bumpLeft]) {
          document.getElementById('bump-left-data').innerHTML = warning;
        } else {
          document.getElementById('bump-left-data').innerHTML = safe;
        }
      }

      if (call.bumpRight) {
        if (booleans[call.bumpRight]) {
          document.getElementById('bump-right-data').innerHTML = warning;
        } else {
          document.getElementById('bump-right-data').innerHTML = safe;
        }
      }

      // if (call.wall)
      // document.getElementById('wall-data').innerHTML = call.wall.toString();

      if (call.velocity)
        document.getElementById('velocity-data').innerHTML = call.velocity;

      if (call.leftEncoder) {
        document.getElementById('left-encoder-data').innerHTML = call.leftEncoder;

        if (lastEncLeft < call.leftEncoder) {
          document.getElementById('left-encoder-data').innerHTML += '&nbsp<i class="green-arr fa fa-arrow-up" aria-hidden="true"></i>';
        } else if (lastEncLeft > call.leftEncoder) {
          document.getElementById('left-encoder-data').innerHTML += '&nbsp<i class="red-arr fa fa-arrow-down" aria-hidden="true"></i>';
        }

        lastEncLeft = call.leftEncoder;
      }

      if (booleans[call.lightBumpLeft]) {
        document.getElementById('light-bump-left-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpLeft])
          document.getElementById('light-bump-left-data').innerHTML = safe;
      }

      if (booleans[call.lightBumpFrontLeft]) {
        document.getElementById('light-bump-front-left-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpFrontLeft])
          document.getElementById('light-bump-front-left-data').innerHTML = safe;
      }
      // if (call.lightBumpFrontLeft) {
      //   document.getElementById('light-bump-front-left-data').innerHTML = call.lightBumpFrontLeft;
      // }
      if (booleans[call.lightBumpCenterLeft]) {
        document.getElementById('light-bump-center-left-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumperLeft])
        document.getElementById('light-bump-center-left-data').innerHTML = safe;
      }

      // if (call.lightBumpCenterLeft) {
      //   document.getElementById('light-bump-center-left-data').innerHTML = call.lightBumpCenterLeft;
      // }

       if (booleans[call.lightBumpCenterRight]) {
        document.getElementById('light-bump-center-right-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpCenterRight])
        document.getElementById('light-bump-center-right-data').innerHTML = safe;
      }
      // if (call.bumpCenterRight) {
      //   document.getElementById('light-bump-center-right-data').innerHTML = call.lightBumpCenterRight;
      // }
      console.log('call',call);
      if (booleans[call.lightBumpFrontRight]) {
        document.getElementById('light-bump-front-right-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpFrontRight])
          document.getElementById('light-bump-front-right-data').innerHTML = safe;
      }
      // if (call.lightBumpFrontRight) {
      //   document.getElementById('light-bump-front-right-data').innerHTML = call.lightBumpFrontRight;
      // }
      if (booleans[call.lightBumpRight]) {
        document.getElementById('light-bump-right-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpRight])
          document.getElementById('light-bump-right-data').innerHTML = safe;
      }
      // if (call.bumpRight) {
      //   document.getElementById('light-bump-right-data').innerHTML = call.lightBumpRight;
      // }

      if (call.rightEncoder)
        document.getElementById('right-encoder-data').innerHTML = call.rightEncoder;

      if (lastEncRight < call.rightEncoder) {
        document.getElementById('right-encoder-data').innerHTML += '&nbsp<i class="green-arr fa fa-arrow-up" aria-hidden="true"></i>';
      } else if (lastEncRight > call.rightEncoder) {
        document.getElementById('right-encoder-data').innerHTML += '&nbsp<i class="red-arr fa fa-arrow-down" aria-hidden="true"></i>';
      }

      lastEncLeft = call.leftEncoder;
    });
    var pathLayerContext;

    drawStep(0, 0, 0, 'quick', '');
    drawStep(0, 0, 0, 'quick', '');
  </script>
  <script src="https://use.fontawesome.com/26c56752cb.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
</body>

</html>