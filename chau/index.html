<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">

  <title>I'd like to Roomba Roomba</title>
  <meta name="description" content="A basic web interface for our Roomba HackTech project.">
  <meta name="author" content="Chau Nguyen">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/index.css?v=1.0">

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <div class="container">
    <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo">&nbsp;Roomba Dashboard</a>
      </div>
    </nav>
    <!--<h2>Roomba Dashboard</h2>-->
    <div class="row">
      <div class="col s12 m6">
        <div id="controls">
          <div class="col s12 offset-s3">
            <img id="ctrl-arr-up" class='responsive-img ctrl-arr' src="images/arrow-up.png" />
          </div>
          <img id="ctrl-arr-left" class='responsive-img ctrl-arr' src="images/arrow-left.png" />
          <img id="stop-driving-btn" class='responsive-img ctrl-arr' src="images/stop.png" />
          <img id="ctrl-arr-right" class='responsive-img ctrl-arr' src="images/arrow-right.png" />
          <div class="col s12 offset-s3">
            <img id="ctrl-arr-down" class='responsive-img ctrl-arr' src="images/arrow-down.png" />
          </div>
        </div>
      </div>
      <div class="col s12 m6">
        <div class="card-panel">
          <div id="bumpers">
            <h5 id="bumpers-header">Bumpers</h5>
            <svg viewBox='0 0 100 100'>
              <circle cx='50' cy='50' r='45' id='gray' />
              <circle cx='50' cy='50' r='45' id='top-left' />
              <circle cx='50' cy='50' r='45' id='top-right' />
              <circle cx='50' cy='50' r='45' id='blue' />
              <circle cx='50' cy='50' r='45' id='orange' />
            </svg>
          </div>
        </div>
      </div>
    </div>
    <ul class="collapsible" data-collapsible="accordion">
      <li>
        <div class="collapsible-header active"><i class="material-icons">insert_chart</i>Statistics</div>
        <div class="collapsible-body">
          <div id="detailed-statistics">
            <div class="row">
              <ul id="statistics-list">
                <div class="col s12 m4">
                  <div class="card-panel">
                    <li id="battery" class="statistic">
                      <img class='dashboard-icon' src="images/battery.jpg" />
                      <h5 class='statistic-header'>&nbsp;Battery</h5>
                      <span id="battery-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m4">
                  <div class="card-panel">
                    <li id="distance" class="statistic">
                      <img class='dashboard-icon' src="images/distance.png" />
                      <h5 class='statistic-header'>&nbsp;Distance</h5>
                      <span id="distance-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m4">
                  <div class="card-panel">
                    <li id="angle" class="statistic">
                      <img class='dashboard-icon' src="./images/angle.png" />
                      <h5 class='statistic-header'>&nbsp;Angle</h5>
                      <span id="angle-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m6">
                  <div class="card-panel">
                    <li id="left-encoder" class="statistic">
                      <h5 class='statistic-header'>&nbsp;Left Encoder</h5>
                      <span id="left-encoder-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m6">
                  <div class="card-panel">
                    <li id="right-encoder" class="statistic">
                      <h5 class='statistic-header'>&nbsp;Right Encoder</h5>
                      <span id="right-encoder-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12">
                  <div class="card-panel">
                    <li id="velocity" class="statistic">
                      <h5 class='statistic-header'>Velocity</h5>
                      <span id="velocity-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m3">
                  <div class="card-panel">
                    <li id="cliff-left" class="statistic">
                      <img class='dashboard-icon' src="./images/cliff-left.jpg" />
                      <h5 class='statistic-header'>&nbsp;Cliff Left</h5>
                      <span id="cliff-left-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m3">
                  <div class="card-panel">
                    <li id="cliff-front-left" class="statistic">
                      <img class='dashboard-icon' src="./images/cliff-ft-left.png" />
                      <h5 class='statistic-header'>&nbsp;Cliff Ft Left</h5>
                      <span id="cliff-front-left-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m3">
                  <div class="card-panel">
                    <li id="cliff-front-right" class="statistic">
                      <img class='dashboard-icon' src="./images/cliff-ft-right.png" />
                      <h5 class='statistic-header'>&nbsp;Cliff Ft Right</h5>
                      <span id="cliff-front-right-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m3">
                  <div class="card-panel">
                    <li id="cliff-right" class="statistic">
                      <img class='dashboard-icon' src="./images/cliff-right.jpg" />
                      <h5 class='statistic-header'>&nbsp;Cliff Right</h5>
                      <span id="cliff-right-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m6">
                  <div class="card-panel">
                    <li id="bump-left" class="statistic">
                      <img class='dashboard-icon' src="./images/bump.png" />
                      <h5 class='statistic-header'>&nbsp;Bump Left</h5>
                      <span id="bump-left-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m6">
                  <div class="card-panel">
                    <li id="bump-right" class="statistic">
                      <img class='dashboard-icon' src="./images/bump.png" />
                      <h5 class='statistic-header'>&nbsp;Bump Right</h5>
                      <span id="bump-right-data"></span>
                    </li>
                  </div>
                </div>
                <!--<div class="col s4">
            <li id="wall" class="statistic">
              <img class='dashboard-icon' src="./images/wall.png" />
              <h5 class='statistic-header'>&nbsp;Wall</h5>
              <span id="wall-data"></span>
            </li>
            </div>-->
                <div class="col s12 m2">
                  <div class="card-panel">
                    <li id="light-bump-left" class="statistic">
                      <h6 class='statistic-header'>&nbsp;LB Left</h6>
                      <span id="light-bump-left-data"></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m2">
                  <div class="card-panel">
                    <li id="light-bump-front-left" class="statistic">
                      <h6 class='statistic-header'>&nbsp;LB Ft Left</h6>
                      <span id="light-bump-front-left-data" class='light-bump'></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m2">
                  <div class="card-panel">
                    <li id="light-bump-center-left" class="statistic">
                      <h6 class='statistic-header'>&nbsp;LB Cen Left</h6>
                      <span id="light-bump-center-left-data" class='light-bump'></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m2">
                  <div class="card-panel">
                    <li id="light-bump-center-right" class="statistic">
                      <h6 class='statistic-header'>&nbsp;LB Cen Right</h6>
                      <span id="light-bump-center-right-data" class='light-bump'></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m2">
                  <div class="card-panel">
                    <li id="light-bump-front-right" class="statistic">
                      <h6 class='statistic-header'>&nbsp;LB Ft. Right</h6>
                      <span id="light-bump-front-right-data" class='light-bump'></span>
                    </li>
                  </div>
                </div>
                <div class="col s12 m2">
                  <div class="card-panel">
                    <li id="light-bump-right" class="statistic">
                      <h6 class='statistic-header'>&nbsp;LB Right</h6>
                      <span id="light-bump-right-data" class='light-bump'></span>
                    </li>
                  </div>
                </div>
              </ul>
            </div>
          </div>
        </div>
  </div>
  </li>
  </ul>


  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="
https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
  <script type="text/javascript">
    var socket = io();

    var lastAngle = 0;
    var lastEncLeft = 0;
    var lastEncRight = 0;
    var moving = false;

    document.getElementById('stop-driving-btn').onclick = function () {
      socket.emit('stop-moving', function (data) {
        console.log('stop')
      });
    }

    document.getElementById("ctrl-arr-up").onclick = function () {
      socket.emit("move-up", function (data) {
        moving = true;
      });
    }

    document.getElementById("ctrl-arr-left").onclick = function () {
      console.log('clicked left arr')
      socket.emit("turn-left", function (data) {
        console.log(data);
      })
    }

    document.getElementById("ctrl-arr-right").onclick = function () {
      console.log('clicked right arr')
      socket.emit("turn-right", function (data) {
        console.log(data);
      })
    }

    document.getElementById("ctrl-arr-down").onclick = function () {
      console.log('clicked down arr')
      socket.emit("go-back", function (data) {
        console.log(data);
      })
    }

    document.getElementById("stop-driving-btn").onclick = function () {
      socket.emit("stop-moving", function (data) {
        if (moving) {
          moving = false;
        }
      });
    }
    socket.on('angle distance changed', function (call) {
      console.log('angle distance is changing');
    });

    socket.on('data has been sent', function (call) {
      // console.log(call);
      var booleans = { "false": false, "true": true };
      if (booleans[call.bumpLeft]) {
        document.getElementById('top-left').style.stroke = 'red';
      } else {
        document.getElementById('top-left').style.stroke = 'green';
      }

      if (booleans[call.bumpRight]) {
        document.getElementById('top-right').style.stroke = 'red';
      } else {
        document.getElementById('top-right').style.stroke = 'green';
      }

      if (call.chargeState)
        document.getElementById('battery-data').innerHTML = call.chargeState;

      if (call.distance)
        document.getElementById('distance-data').innerHTML = call.distance + '&nbsp;mm';

      if (call.angle) {
        document.getElementById('angle-data').innerHTML = call.angle;
      }

      var warning = "<span style='color:red;' class='warning'>!</span>";
      var safe = "<span style='color:green' fade-in'><i class='fa fa-check'></i></span>";
      if (call.cliffLeft) {
        if (booleans[call.cliffLeft]) {
          document.getElementById('cliff-left-data').innerHTML = warning;
        } else {
          document.getElementById('cliff-left-data').innerHTML = safe;
        }
      }

      if (call.cliffFrontLeft) {
        if (booleans[call.cliffFrontLeft]) {
          document.getElementById('cliff-front-left-data').innerHTML = warning;
        } else {
          document.getElementById('cliff-front-left-data').innerHTML = safe;
        }
      }

      if (call.cliffFrontRight) {
        if (booleans[call.cliffFrontRight]) {
          document.getElementById('cliff-front-right-data').innerHTML = warning;
        } else {
          document.getElementById('cliff-front-right-data').innerHTML = safe;
        }
      }

      if (call.cliffRight) {
        if (booleans[call.cliffRight]) {
          document.getElementById('cliff-right-data').innerHTML = warning;
        } else {
          document.getElementById('cliff-right-data').innerHTML = safe;
        }
      }

      if (call.bumpLeft) {
        if (booleans[call.bumpLeft]) {
          document.getElementById('bump-left-data').innerHTML = warning;
        } else {
          document.getElementById('bump-left-data').innerHTML = safe;
        }
      }

      if (call.bumpRight) {
        if (booleans[call.bumpRight]) {
          document.getElementById('bump-right-data').innerHTML = warning;
        } else {
          document.getElementById('bump-right-data').innerHTML = safe;
        }
      }

      if (call.velocity)
        document.getElementById('velocity-data').innerHTML = call.velocity;

      if (call.leftEncoder) {
        document.getElementById('left-encoder-data').innerHTML = call.leftEncoder;

        if (lastEncLeft < call.leftEncoder) {
          document.getElementById('left-encoder-data').innerHTML += '&nbsp<i class="green-arr fa fa-arrow-up" aria-hidden="true"></i>';
        } else if (lastEncLeft > call.leftEncoder) {
          document.getElementById('left-encoder-data').innerHTML += '&nbsp<i class="red-arr fa fa-arrow-down" aria-hidden="true"></i>';
        }

        lastEncLeft = call.leftEncoder;
      }

      if (booleans[call.lightBumpLeft]) {
        document.getElementById('light-bump-left-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpLeft])
          document.getElementById('light-bump-left-data').innerHTML = safe;
      }

      if (booleans[call.lightBumpFrontLeft]) {
        document.getElementById('light-bump-front-left-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpFrontLeft])
          document.getElementById('light-bump-front-left-data').innerHTML = safe;
      }

      if (booleans[call.lightBumpCenterLeft]) {
        document.getElementById('light-bump-center-left-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumperLeft])
          document.getElementById('light-bump-center-left-data').innerHTML = safe;
      }

      if (booleans[call.lightBumpCenterRight]) {
        document.getElementById('light-bump-center-right-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpCenterRight])
          document.getElementById('light-bump-center-right-data').innerHTML = safe;
      }

      console.log('call', call);
      if (booleans[call.lightBumpFrontRight]) {
        document.getElementById('light-bump-front-right-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpFrontRight])
          document.getElementById('light-bump-front-right-data').innerHTML = safe;
      }

      if (booleans[call.lightBumpRight]) {
        document.getElementById('light-bump-right-data').innerHTML = 'WALL';
      } else {
        if (!booleans[call.lightBumpRight])
          document.getElementById('light-bump-right-data').innerHTML = safe;
      }

      if (call.rightEncoder)
        document.getElementById('right-encoder-data').innerHTML = call.rightEncoder;

      if (lastEncRight < call.rightEncoder) {
        document.getElementById('right-encoder-data').innerHTML += '&nbsp<i class="green-arr fa fa-arrow-up" aria-hidden="true"></i>';
      } else if (lastEncRight > call.rightEncoder) {
        document.getElementById('right-encoder-data').innerHTML += '&nbsp<i class="red-arr fa fa-arrow-down" aria-hidden="true"></i>';
      }

      lastEncLeft = call.leftEncoder;
    });
  </script>
  <script src="https://use.fontawesome.com/26c56752cb.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
</body>

</html>